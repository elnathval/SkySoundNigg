<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>SkySound</title>
	<!-- Google Fonts for Montserrat font family -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
	<style>
		/* CSS Variables for theme colors */
		:root {
			--color-background: #181a20;
			--color-background-overlay: #101117;
			--color-shadow: #0005;
			--color-text: #e0e0e0;
			--color-heading: #64b5f6;
			--color-button-hover: #d7eafa;
			--color-slider: #303440;
		}
		/* General body and heading styles */
		body {
			font-family: 'Montserrat', sans-serif;
			background-color: var(--color-background);
			color: var(--color-text);
			margin: 0;
			text-align: center;
		}
		h1, h2 { color: var(--color-heading); }
		/* Title bar styling */
		.title {
			background-color: var(--color-background-overlay);
			padding: 20px 0 30px;
			box-shadow: 0 4px 24px var(--color-shadow);
		}
		/* Main button styling */
		.button {
			background-color: var(--color-heading);
			color: var(--color-background);
			border: none;
			padding: 12px 28px;
			border-radius: 8px;
			font-size: 1.5rem;
			font-weight: 700;
			cursor: pointer;
			margin-top: 30px;
			transition: background 0.25s;
			box-shadow: 0 4px 24px var(--color-shadow);
		}
		.button:hover { background-color: var(--color-button-hover); }
		/* Close button for overlay */
		.button-close {
			background: none;
			border: none;
			font-size: 24px;
			color: var(--color-text);
			cursor: pointer;
			transition: color 0.25s;
			position: absolute;
			top: 15px;
			right: 15px;
		}
		.button-close:hover { color: var(--color-button-hover); }
		/* Overlay for upload modal */
		.overlay {
			display: none;
			position: fixed;
			top: 0; left: 0; right: 0; bottom: 0;
			justify-content: center;
			align-items: center;
			backdrop-filter: blur(8px);
		}
		.overlay.active { display: flex; }
		.overlay-content {
			background: var(--color-background-overlay);
			padding: 40px 40px;
			border-radius: 12px;
			box-shadow: 0 4px 24px var(--color-shadow);
			text-align: center;
			min-width: 300px;
			position: relative;
		}
		/* Form group styling for upload form */
		.form-group {
			display: flex;
			flex-direction: column;
			align-items: flex-start;
		}
		.form-group input[type="text"] {
			width: 100%;
			padding: 12px 16px;
			border: 1.5px solid var(--color-heading);
			border-radius: 6px;
			background: var(--color-background);
			color: var(--color-text);
			font-size: 1rem;
			box-sizing: border-box;
			box-shadow: 0 4px 24px var(--color-shadow);
		}
		/* Dropzone for file/image upload */
		.dropzone {
			width: 100%;
			padding: 32px;
			border: 2px dashed var(--color-heading);
			border-radius: 8px;
			background: var(--color-background);
			transition: background 0.25s, border-color 0.25s;
			cursor: pointer;
			box-sizing: border-box;
			text-align: center;
			user-select: none;
		}
		.dropzone.dragover {
			background: var(--color-dropzone-hover);
			border-color: var(--color-button-hover);
			color: var(--color-button-hover);
		}
		.dropzone input[type="file"] { display: none; }
		#dropzoneText {
			display: inline-block;
			max-width: 220px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		#imagePreview {
			max-width: 180px;
			max-height: 180px;
			border-radius: 8px;
			margin: 0 auto;
			display: block;
			object-fit: cover;
			aspect-ratio: 1/1;
		}
		/* Song list container */
		#songsList {
			margin: 30px auto 0 auto;
			max-width: 600px;
			display: flex;
			flex-direction: column;
			gap: 32px;
		}
		/* Song card styling */
		.song-card {
			display: flex;
			align-items: center;
			background: var(--color-background-overlay);
			border-radius: 12px;
			box-shadow: 0 4px 24px var(--color-shadow);
			padding: 30px;
			gap: 24px;
		}
		.song-cover {
			width: 80px;
			height: 80px;
			border-radius: 8px;
			object-fit: cover;
			flex-shrink: 0;
			box-shadow: 0 4px 24px var(--color-shadow);
		}
		.song-info {
			flex: 1;
			text-align: left;
		}
		.song-name {
			font-size: 1.2rem;
			font-weight: 700;
			color: var(--color-heading);
			margin-top: 4px;
		}
		.song-author {
			font-size: 1rem;
			color: var(--color-text);
			margin-bottom: 4px;
		}
		.song-play {
			width: 48px;
			height: 48px;
			border: none;
			background: var(--color-heading);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: background 0.25s;
			box-shadow: 0 4px 24px var(--color-shadow);
		}
		.song-play:hover { background: var(--color-button-hover); }
		.song-play-icon, .song-pause-icon {
			width: 24px;
			height: 24px;
			fill: var(--color-background);
		}
		#playerBar {
			position: fixed;
			left: 0;
			right: 0;
			bottom: 0;
			height: 90px;
			background: var(--color-background-overlay);
			box-shadow: 0 4px 24px var(--color-shadow);
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 0 20px;
			color: var(--color-text);
			gap: 24px;
		}
		.player-left {
			display: flex;
			align-items: center;
			gap: 16px;
		}
		.player-cover {
			width: 56px;
			height: 56px;
			border-radius: 8px;
			object-fit: cover;
			background: #222;
			box-shadow: 0 4px 24px var(--color-shadow);
		}
		.player-songinfo {
			display: flex;
			flex-direction: column;
			align-items: flex-start;
			overflow: hidden;
		}
		.player-songname {
			font-size: 1.2rem;
			font-weight: 700;
			color: var(--color-heading);
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			max-width: 200px;
			margin-bottom: 2px;
		}
		.player-songauthor {
			font-size: 0.95rem;
			color: var(--color-text);
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			max-width: 200px;
			margin-top: 2px;
		}
		.player-center {
			display: flex;
			flex-direction: column;
			align-items: center;
			flex: 1;
			min-width: 0;
		}
		.player-controls {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 16px;
			margin-bottom: 6px;
		}
		.player-play, .player-pause {
			width: 44px;
			height: 44px;
			border: none;
			background: var(--color-heading);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: background 0.25s;
			box-shadow: 0 4px 24px var(--color-shadow);
		}
		.player-play:hover, .player-pause:hover { background: var(--color-button-hover); }
		.player-play-icon, .player-pause-icon {
			width: 24px;
			height: 24px;
			fill: var(--color-background);
		}
		.player-timeline {
			display: flex;
			align-items: center;
			gap: 8px;
			width: 320px;
			max-width: 60vw;
		}
		.player-time {
			font-size: 0.95rem;
			width: 40px;
			text-align: center;
			color: var(--color-text);
		}
		/* Sliders for time and volume */
		.player-bar-range,
		.player-volume-range {
			flex: 1;
			width: 90px;
			appearance: none;
			height: 4px;
			border-radius: 2px;
			background: var(--color-slider);
			outline: none;
			transition: background 0.25s;
		}
		.player-bar-range::-webkit-slider-thumb,
		.player-volume-range::-webkit-slider-thumb {
			appearance: none;
			width: 12px;
			height: 12px;
			border-radius: 50%;
			background: var(--color-heading);
			cursor: pointer;
			box-shadow: 0 4px 24px var(--color-shadow);
			border: none;
			margin-top: -4px;
			position: relative;
			z-index: 2;
		}
		.player-bar-range:focus,
		.player-volume-range:focus { outline: none; }
		.player-bar-range::-webkit-slider-thumb:hover,
		.player-volume-range::-webkit-slider-thumb:hover { background: var(--color-button-hover); }
		.player-bar-range::-webkit-slider-runnable-track,
		.player-volume-range::-webkit-slider-runnable-track {
			height: 4px;
			border-radius: 2px;
			background: transparent;
		}
		.player-right {
			display: flex;
			align-items: center;
			gap: 12px;
			min-width: 120px;
			justify-content: flex-end;
		}
		.player-volume-icon {
			width: 22px;
			height: 22px;
			fill: var(--color-heading);
		}
		/* Firefox and IE slider styles for compatibility */
		.player-bar-range::-moz-range-thumb,
		.player-volume-range::-moz-range-thumb {
			width: 12px;
			height: 12px;
			border-radius: 50%;
			background: var(--color-heading);
			cursor: pointer;
			box-shadow: 0 4px 24px var(--color-shadow);
			border: none;
		}
		.player-bar-range::-moz-range-progress,
		.player-volume-range::-moz-range-progress {
			background-color: var(--color-heading);
			height: 4px;
			border-radius: 2px;
		}
		.player-bar-range::-moz-range-track,
		.player-volume-range::-moz-range-track {
			background-color: var(--color-slider);
			height: 4px;
			border-radius: 2px;
		}
		.player-bar-range:focus::-webkit-slider-thumb,
		.player-volume-range:focus::-webkit-slider-thumb {
			outline: none;
		}
		.player-bar-range::-ms-fill-lower,
		.player-volume-range::-ms-fill-lower {
			background: var(--color-heading);
		}
		.player-bar-range::-ms-fill-upper,
		.player-volume-range::-ms-fill-upper {
			background: var(--color-slider);
		}
		/* Volume percentage display */
		.player-volumepercentage {
			font-size: 0.95rem;
			color: var(--color-text);
			text-align: right;
			width: 40px;
		}
	</style>
</head>
<body>
	<!-- App Title -->
	<div class="title">
		<h1>SkySound</h1>
		<p>A place to upload your music freely</p>
	</div>
	<!-- Upload Button -->
	<button class="button" id="openUploadMenu">+ Upload</button>
	<!-- List of uploaded songs will appear here -->
	<div id="songsList"></div>
	<!-- Overlay for uploading a new song -->
	<div class="overlay" id="toggleOverlay">
		<div class="overlay-content">
			<button class="button-close" id="closeUploadMenu" title="Close">&times;</button>
			<h2>Upload a song</h2>
			<!-- Audio file dropzone -->
			<div class="dropzone" id="dropzone">
				<span id="dropzoneText">Drop an audio file here</span>
				<input type="file" id="audioInput" accept="audio/*">
			</div>
			<!-- Song author input -->
			<div class="form-group">
				<p for="authorInput">Author</p>
				<input type="text" id="authorInput" placeholder="Enter author's name">
			</div>
			<!-- Song name input -->
			<div class="form-group">
				<p for="nameInput">Name</p>
				<input type="text" id="nameInput" placeholder="Enter song's name">
				<p for="imageDropzoneText">Cover</p>
			</div>
			<!-- Cover image dropzone -->
			<div class="dropzone" id="imageDropzone">
				<span id="imageDropzoneText">Drop a cover image here</span>
				<input type="file" id="imageInput" accept="image/*">
			</div>
			<!-- Upload button -->
			<button class="button" id="uploadSong">Upload</button>
		</div>
	</div>
	<!-- Player bar at the bottom -->
	<div id="playerBar" style="display:none;">
		<div class="player-left">
			<img class="player-cover" id="playerCover" src="" alt="Cover" />
			<div class="player-songinfo">
				<div class="player-songname" id="playerSongName"></div>
				<div class="player-songauthor" id="playerSongAuthor"></div>
			</div>
		</div>
		<div class="player-center">
			<div class="player-controls">
				<!-- Play/Pause button for the player bar -->
				<button class="player-play" id="playerPlayButton" title="Play">
					<svg class="player-play-icon" id="playerPlayIcon" viewBox="0 0 24 24">
						<polygon points="6,4 20,12 6,20" />
					</svg>
					<svg class="player-pause-icon" id="playerPauseIcon" viewBox="0 0 24 24" style="display:none;">
						<rect x="6" y="4" width="4" height="16"/>
						<rect x="14" y="4" width="4" height="16"/>
					</svg>
				</button>
			</div>
			<!-- Timeline slider and time display -->
			<div class="player-timeline">
				<span class="player-time" id="playerCurrentTime">0:00</span>
				<input type="range" class="player-bar-range" id="playerTimeBar" min="0" max="100" value="0">
				<span class="player-time" id="playerDuration">0:00</span>
			</div>
		</div>
		<div class="player-right">
			<!-- Volume icon and slider -->
			<svg class="player-volume-icon" viewBox="0 0 24 24">
				<path d="M13 6.037c0-1.724-1.978-2.665-3.28-1.562L5.638 7.933H4c-1.105 0-2 .91-2 2.034v4.066c0 1.123.895 2.034 2 2.034h1.638l4.082 3.458c1.302 1.104 3.28.162 3.28-1.562V6.037Z"/>
				<path fill-rule="evenodd" d="M14.786 7.658a.988.988 0 0 1 1.414-.014A6.135 6.135 0 0 1 18 12c0 1.662-.655 3.17-1.715 4.27a.989.989 0 0 1-1.414.014 1.029 1.029 0 0 1-.014-1.437A4.085 4.085 0 0 0 16 12a4.085 4.085 0 0 0-1.2-2.904 1.029 1.029 0 0 1-.014-1.438Z" clip-rule="evenodd"/>
				<path fill-rule="evenodd" d="M17.657 4.811a.988.988 0 0 1 1.414 0A10.224 10.224 0 0 1 22 12c0 2.807-1.12 5.35-2.929 7.189a.988.988 0 0 1-1.414 0 1.029 1.029 0 0 1 0-1.438A8.173 8.173 0 0 0 20 12a8.173 8.173 0 0 0-2.343-5.751 1.029 1.029 0 0 1 0-1.438Z" clip-rule="evenodd"/>
			</svg>
			<input type="range" class="player-volume-range" id="playerVolume" min="0" max="1" step="0.01" value="1">
				<div class="player-volumepercentage" id="playerVolumePercentage">100%</div>
		</div>
		<!-- Hidden audio element for playback -->
		<audio id="playerAudio" style="display:none"></audio>
	</div>
	<script>
		// --- DOM element references ---
		const openUploadMenu = document.getElementById("openUploadMenu");
		const toggleOverlay = document.getElementById("toggleOverlay");
		const closeUploadMenu = document.getElementById("closeUploadMenu");
		const dropzone = document.getElementById("dropzone");
		const audioInput = document.getElementById("audioInput");
		const dropzoneText = document.getElementById("dropzoneText");
		const imageDropzone = document.getElementById("imageDropzone");
		const imageInput = document.getElementById("imageInput");
		const imageDropzoneText = document.getElementById("imageDropzoneText");
		const uploadSong = document.getElementById("uploadSong");
		const authorInput = document.getElementById("authorInput");
		const nameInput = document.getElementById("nameInput");
		const songsList = document.getElementById("songsList");
		const playerBar = document.getElementById("playerBar");
		const playerCover = document.getElementById("playerCover");
		const playerSongName = document.getElementById("playerSongName");
		const playerSongAuthor = document.getElementById("playerSongAuthor");
		const playerPlayButton = document.getElementById("playerPlayButton");
		const playerPlayIcon = document.getElementById("playerPlayIcon");
		const playerPauseIcon = document.getElementById("playerPauseIcon");
		const playerAudio = document.getElementById("playerAudio");
		const playerTimeBar = document.getElementById("playerTimeBar");
		const playerCurrentTime = document.getElementById("playerCurrentTime");
		const playerDuration = document.getElementById("playerDuration");
		const playerVolume = document.getElementById("playerVolume");
		const playerVolumePercentage = document.getElementById("playerVolumePercentage");
		let coverDataUrl = null;
		let currentSongCard = null;
		let currentSongplayButton = null;
		let currentSongPlayIcon = null;
		let currentSongPauseIcon = null;

		// --- Overlay open/close logic ---
		openUploadMenu.addEventListener("click", () => {
			toggleOverlay.classList.add("active");
		});
		closeUploadMenu.addEventListener("click", () => {
			toggleOverlay.classList.remove("active");
		});

		// --- Audio file dropzone logic ---
		dropzone.addEventListener("dragover", (e) => {
			e.preventDefault();
			dropzone.classList.add("dragover");
		});
		dropzone.addEventListener("dragleave", (e) => {
			e.preventDefault();
			dropzone.classList.remove("dragover");
		});
		dropzone.addEventListener("drop", (e) => {
			e.preventDefault();
			dropzone.classList.remove("dragover");
			const files = e.dataTransfer.files;
			if (files.length > 0) {
				audioInput.files = files;
				dropzoneText.textContent = files[0].name;
			}
		});
		dropzone.addEventListener("click", () => {
			audioInput.click();
		});
		audioInput.addEventListener("change", () => {
			if (audioInput.files.length > 0) {
				dropzoneText.textContent = audioInput.files[0].name;
			} else {
				dropzoneText.textContent = "Drop an audio file here";
			}
		});

		// --- Image file dropzone logic ---
		imageDropzone.addEventListener("dragover", (e) => {
			e.preventDefault();
			imageDropzone.classList.add("dragover");
		});
		imageDropzone.addEventListener("dragleave", (e) => {
			e.preventDefault();
			imageDropzone.classList.remove("dragover");
		});
		imageDropzone.addEventListener("drop", (e) => {
			e.preventDefault();
			imageDropzone.classList.remove("dragover");
			const files = e.dataTransfer.files;
			if (files.length > 0 && files[0].type.startsWith("image/")) {
				handleImageFile(files[0]);
				imageInput.files = files;
			}
		});
		imageDropzone.addEventListener("click", () => {
			imageInput.click();
		});
		imageInput.addEventListener("change", () => {
			if (imageInput.files.length > 0) {
				handleImageFile(imageInput.files[0]);
			} else {
				resetImageDropzone();
			}
		});

		// --- Image file processing and preview ---
		function handleImageFile(file) {
			const reader = new FileReader();
			reader.onload = function(e) {
				const img = new window.Image();
				img.onload = function() {
					const size = Math.min(img.width, img.height);
					const canvas = document.createElement('canvas');
					canvas.width = size;
					canvas.height = size;
					const ctx = canvas.getContext('2d');
					// Crop to square and compress
					ctx.drawImage(
						img,
						(img.width - size) / 2,
						(img.height - size) / 2,
						size,
						size,
						0,
						0,
						size,
						size
					);
					let quality = 0.92;
					let dataUrl = canvas.toDataURL('image/jpeg', quality);
					let byteString = atob(dataUrl.split(',')[1]);
					let byteLength = byteString.length;
					while (byteLength > 500 * 1024 && quality > 0.1) {
						quality -= 0.05;
						dataUrl = canvas.toDataURL('image/jpeg', quality);
						byteString = atob(dataUrl.split(',')[1]);
						byteLength = byteString.length;
					}
					coverDataUrl = dataUrl;
					showImagePreview(dataUrl);
				};
				img.src = e.target.result;
			};
			reader.readAsDataURL(file);
		}
		function showImagePreview(dataUrl) {
			imageDropzoneText.style.display = "none";
			let img = document.getElementById("imagePreview");
			if (!img) {
				img = document.createElement("img");
				img.id = "imagePreview";
				imageDropzone.appendChild(img);
			}
			img.src = dataUrl;
			img.style.display = "block";
		}
		function resetImageDropzone() {
			imageDropzoneText.style.display = "";
			const img = document.getElementById("imagePreview");
			if (img) {
				img.remove();
			}
			coverDataUrl = null;
		}

		// --- Upload song logic ---
		uploadSong.addEventListener("click", () => {
			const author = authorInput.value.trim();
			const name = nameInput.value.trim();
			const audioFile = audioInput.files[0];
			const cover = coverDataUrl;

			// Validate all fields
			if (!author || !name || !audioFile || !cover) {
				alert("Please provide the song's audio file, author, name, and cover image.");
				return;
			}
			const reader = new FileReader();
			reader.onload = function(e) {
				const audioFile = e.target.result;
				addSongToList({
					audioFile,
					author,
					name,
					cover
				});
				// Reset form
				authorInput.value = "";
				nameInput.value = "";
				audioInput.value = "";
				dropzoneText.textContent = "Drop an audio file here";
				resetImageDropzone();
				toggleOverlay.classList.remove("active");
			};
			reader.readAsDataURL(audioFile);
		});

		// --- Add a new song card to the list ---
		function addSongToList({ cover, author, name, audioFile }) {
			const card = document.createElement("div");
			card.className = "song-card";
			card.innerHTML = `
				<img class="song-cover" src="${cover}" alt="Cover">
				<div class="song-info">
					<div class="song-author">${author}</div>
					<div class="song-name">${name}</div>
				</div>
				<button class="song-play" title="Play">
					<svg class="song-play-icon" viewBox="0 0 24 24">
						<polygon points="6,4 20,12 6,20" />
					</svg>
					<!-- Pause icon SVG for the song card -->
					<svg class="song-pause-icon" viewBox="0 0 24 24" style="display:none;">
						<rect x="6" y="4" width="4" height="16"/>
						<rect x="14" y="4" width="4" height="16"/>
					</svg>
				</button>
				<audio style="display:none" src="${audioFile}"></audio>
			`;
			const playButton = card.querySelector('.song-play');
			const playIcon = card.querySelector('.song-play-icon');
			const pauseIcon = card.querySelector('.song-pause-icon');
			playButton.addEventListener('click', () => {
				// If this card is already playing, toggle play/pause
				if (currentSongCard === card) {
					if (playerAudio.paused) {
						playerAudio.play();
					} else {
						playerAudio.pause();
					}
				} else {
					// Otherwise, load this song into the player bar
					showPlayerBar({
						cover,
						author,
						name,
						audioFile
					}, card, playButton, playIcon, pauseIcon);
					playerAudio.play();
				}
			});
			songsList.prepend(card);
		}

		// --- Show the player bar and load a song ---
		function showPlayerBar({ cover, author, name, audioFile }, card = null, playButton = null, playIcon = null, pauseIcon = null) {
			playerBar.style.display = "flex";
			playerCover.src = cover;
			playerSongName.textContent = name;
			playerSongAuthor.textContent = author;
			playerAudio.src = audioFile;
			playerAudio.currentTime = 0;
			playerAudio.volume = playerVolume.value;
			playerAudio.pause();
			updatePlayerTime();
			updatePlayPauseBtn();
			currentSongCard = card;
			currentSongplayButton = playButton;
			currentSongPlayIcon = playIcon;
			currentSongPauseIcon = pauseIcon;
			updateSongCardPlayPauseBtn();
		}

		// --- Player bar play/pause button logic ---
		playerPlayButton.addEventListener("click", () => {
			if (playerAudio.paused) {
				playerAudio.play();
			} else {
				playerAudio.pause();
			}
			updateSongCardPlayPauseBtn();
		});
		playerAudio.addEventListener("play", () => {
			updatePlayPauseBtn();
			updateSongCardPlayPauseBtn();
		});
		playerAudio.addEventListener("pause", () => {
			updatePlayPauseBtn();
			updateSongCardPlayPauseBtn();
		});

		// --- Update play/pause icons in player bar ---
		function updatePlayPauseBtn() {
			if (playerAudio.paused) {
				playerPlayIcon.style.display = "";
				playerPauseIcon.style.display = "none";
			} else {
				playerPlayIcon.style.display = "none";
				playerPauseIcon.style.display = "";
			}
		}

		// --- Update play/pause icons in song cards ---
		function updateSongCardPlayPauseBtn() {
			document.querySelectorAll('.song-card').forEach(card => {
				const playIcon = card.querySelector('.song-play-icon');
				const pauseIcon = card.querySelector('.song-pause-icon');
				if (playIcon && pauseIcon) {
					playIcon.style.display = "";
					pauseIcon.style.display = "none";
				}
			});
			if (currentSongCard && currentSongplayButton) {
				const playIcon = currentSongCard.querySelector('.song-play-icon');
				const pauseIcon = currentSongCard.querySelector('.song-pause-icon');
				if (playerAudio.paused) {
					playIcon.style.display = "";
					pauseIcon.style.display = "none";
				} else {
					playIcon.style.display = "none";
					pauseIcon.style.display = "";
				}
			}
		}

		// --- Player timeline and slider logic ---
		playerAudio.addEventListener("timeupdate", updatePlayerTime);
		playerAudio.addEventListener("loadedmetadata", updatePlayerTime);
		playerTimeBar.addEventListener("input", () => {
			playerAudio.currentTime = (playerTimeBar.value / 100) * playerAudio.duration;
			setSliderFill(playerTimeBar);
		});
		playerAudio.addEventListener("timeupdate", () => {
			if (!isNaN(playerAudio.duration)) {
				playerTimeBar.value = (playerAudio.currentTime / playerAudio.duration) * 100;
				setSliderFill(playerTimeBar);
			}
		});
		function updatePlayerTime() {
			playerCurrentTime.textContent = formatTime(playerAudio.currentTime);
			playerDuration.textContent = isNaN(playerAudio.duration) ? "0:00" : formatTime(playerAudio.duration);
			if (!isNaN(playerAudio.duration)) {
				playerTimeBar.value = (playerAudio.currentTime / playerAudio.duration) * 100;
			} else {
				playerTimeBar.value = 0;
			}
			setSliderFill(playerTimeBar);
		}
		function formatTime(sec) {
			const m = Math.floor(sec / 60);
			const s = Math.floor(sec % 60);
			return `${m}:${s.toString().padStart(2, "0")}`;
		}

		// --- Volume slider logic ---
		playerVolume.addEventListener("input", () => {
			playerAudio.volume = playerVolume.value;
			setSliderFill(playerVolume);
			const p = Math.round(playerVolume.value * 100);
			playerVolumePercentage.textContent = `${p}%`;
		});
		playerVolume.addEventListener("change", () => setSliderFill(playerVolume));

		// --- Slider fill effect for both time and volume sliders ---
		function setSliderFill(slider) {
			const min = parseFloat(slider.min) || 0;
			const max = parseFloat(slider.max) || 100;
			const val = parseFloat(slider.value);
			const percent = ((val - min) / (max - min)) * 100;
			const color = getComputedStyle(document.documentElement).getPropertyValue('--color-heading').trim();
			const bg = getComputedStyle(document.documentElement).getPropertyValue('--color-slider').trim();
			slider.style.background = `linear-gradient(to right, ${color} 0%, ${color} ${percent}%, ${bg} ${percent}%, ${bg} 100%)`;
		}
		setSliderFill(playerTimeBar);
		setSliderFill(playerVolume);

		// --- Pause audio on page unload ---
		window.addEventListener("beforeunload", () => {
			playerAudio.pause();
		});
	</script>
</body>
</html>